<div class="dashboard-root">
  <header class="navbar">
    <button class="menu-btn" (click)="toggleSidebar()" aria-label="menu">â˜°</button>
    <div class="brand">Doctor Dashboard</div>

    <div class="nav-right">
      <span class="doctor-name">Dr. {{ doctorName }}</span>
    </div>
  </header>

  <!-- ðŸŒŸ Account & Availability Panel -->
  <div class="account-panel">
    <div class="panel-row">
      <div class="panel-item">
        <label>Account Status</label>
        <div
          class="status-pill"
          [ngClass]="{
            active: accountStatus === 'Active',
            inactive: accountStatus === 'Inactive'
          }"
        >
          {{ accountStatus }}
        </div>
      </div>

      <div class="panel-item">
        <label>Current Status</label>
        <div class="inline" *ngIf="accountStatus === 'Active'; else inactiveBlock">
          <select [(ngModel)]="availability">
            <option *ngFor="let s of availabilityOptions" [value]="s">
              {{ s }}
            </option>
          </select>
          <button class="mini-btn" (click)="updateAvailability()">Update</button>
        </div>

        <ng-template #inactiveBlock>
          <span class="muted">--</span>
        </ng-template>
      </div>

      <div class="panel-item">
        <label>Shift</label>
        <span *ngIf="!loadingAllocations">{{ latestShift || 'â€”' }}</span>
        <span *ngIf="loadingAllocations">Loading...</span>
      </div>

      <div class="panel-item">
        <label>Room No.</label>
        <span *ngIf="!loadingAllocations">{{ latestRoom || 'â€”' }}</span>
        <span *ngIf="loadingAllocations">Loading...</span>
      </div>
    </div>
  </div>

  <!-- ðŸŒŸ Sidebar -->
  <aside class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-inner">
      <button class="close-btn" (click)="toggleSidebar()">âœ•</button>
      <nav class="sidebar-menu">
        <button (click)="viewAppointments()">View Appointments</button>
        <button (click)="viewFollowupCalendar()">Follow-up Calendar</button>
        <button (click)="viewHistory()">Appointments History</button>
        <button (click)="viewProfile()">View Profile</button>
        <button class="logout-btn" (click)="logout()">Logout</button>
      </nav>
    </div>
  </aside>

  <!-- ðŸŒŸ Main Content -->
  <main class="content" [class.shifted]="sidebarOpen">
    <section class="today">

      <!-- âœ… Appointments -->
      <div class="content" *ngIf="currentView === 'appointments'">
  <h2>Scheduled Appointments</h2>
  <hr class="divider" />

  <div *ngIf="appointments.length > 0; else noApp">
    <div *ngFor="let a of appointments" class="appointment">
      <div class="left">
        <div class="pname">Appointment ID: {{ a.appointmentId }}</div>
        <div class="pname">Patient ID: {{ a.patientId }}</div>
        <div class="pid">Type: {{ a.type }}</div>
        <div class="pid">Slot: {{ a.slot }}</div>
      </div>

      <div class="right">
        <div class="datetime">Time: {{ a.time }}</div>
        <div class="desc">{{ a.description }}</div>

        <!-- âœ… Action Buttons -->
        <div class="actions">
          <button
            class="mini-btn visit-btn"
            [disabled]="a.visited"
            (click)="markVisited(a)"
          >
            {{ a.visited ? 'Visited âœ…' : 'Visit' }}
          </button>

          <button
            class="mini-btn followup-btn"
            [disabled]="!a.visited"
            (click)="openCalendar(a)"
          >
            {{ a.followupDate ? 'Follow-up: ' + a.followupDate : 'Follow-up' }}
          </button>
        </div>

        <!-- âœ… Calendar for Follow-up -->
        <div
          *ngIf="showCalendarFor === a.appointmentId"
          class="calendar-popup"
        >
          <input
            type="date"
            [(ngModel)]="selectedDate"
            [min]="today"
            class="calendar-input"
          />
          <button class="mini-btn save-btn" (click)="scheduleFollowup(a)">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noApp>
    <div class="no-app">No scheduled appointments.</div>
  </ng-template>
</div>

<!-- âœ… Follow-up Calendar -->
<div class="content" *ngIf="currentView === 'calendar'">
  <h2>Follow-up Calendar</h2>
  <hr class="divider" />

  <!-- ðŸ“… Embed the standalone calendar component -->
  <app-calendar></app-calendar>
</div>

      <!-- âœ… History -->
      <div class="content" *ngIf="currentView === 'history'">
        <h2>Appointment History</h2>
        <hr class="divider" />

        <div *ngIf="historyAppointments.length > 0; else noHistory">
          <div *ngFor="let a of historyAppointments" class="appointment past">
            <div class="left">
              <div class="pname">Patient ID: {{ a.patientId }}</div>
              <div class="pid">Type: {{ a.type }}</div>
            </div>
            <div class="right">
              <div class="datetime">{{ a.time }}</div>
              <div class="desc">{{ a.description }}</div>
              <div class="status consulted">Status: Consulted âœ…</div>
            </div>
          </div>
        </div>

        <ng-template #noHistory>
          <div class="no-app">No appointments history.</div>
        </ng-template>
      </div>

      <!-- âœ… Profile -->
      <div class="content" *ngIf="currentView === 'profile'">
        <app-doctor-profile></app-doctor-profile>
      </div>

    </section>
  </main>
</div>
